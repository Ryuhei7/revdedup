\hypertarget{restore_8c}{\section{restore.\-c \-File \-Reference}
\label{restore_8c}\index{restore.\-c@{restore.\-c}}
}


\-Implements restoration of images without reverse deduplication.  


{\ttfamily \#include $<$revdedup.\-h$>$}\*
{\ttfamily \#include $<$queue.\-h$>$}\*
{\ttfamily \#include $<$datatable.\-h$>$}\*
{\ttfamily \#include \char`\"{}minilzo.\-h\char`\"{}}\*
\subsection*{\-Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structDataInfo}{\-Data\-Info}
\end{DoxyCompactItemize}
\subsection*{\-Functions}
\begin{DoxyCompactItemize}
\item 
void $\ast$ \hyperlink{restore_8c_aaed3800a08e9d09b339503a082c9e9bc}{prefetch} (void $\ast$ptr)
\item 
void $\ast$ \hyperlink{restore_8c_a6520fe309575d62e6a3311267c491bf5}{decompress} (void $\ast$ptr)
\item 
void $\ast$ \hyperlink{restore_8c_acc039373c16414237269e7bc088823f1}{send} (void $\ast$ptr)
\item 
int \hyperlink{restore_8c_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}
\subsection*{\-Variables}
\begin{DoxyCompactItemize}
\item 
\hypertarget{restore_8c_a7b468d6945d9e7fe97fcc4b2e8f3bb6e}{\hyperlink{structIMEntry}{\-I\-M\-Entry} $\ast$ {\bfseries ien}}\label{restore_8c_a7b468d6945d9e7fe97fcc4b2e8f3bb6e}

\item 
\hypertarget{restore_8c_af300154ee884b0a273fba0373e0c7c29}{\hyperlink{structSMEntry}{\-S\-M\-Entry} $\ast$ {\bfseries sen}}\label{restore_8c_af300154ee884b0a273fba0373e0c7c29}

\item 
\hypertarget{restore_8c_a31ce65cf3eb59b34ee40e3f00408b216}{\hyperlink{structCMEntry}{\-C\-M\-Entry} $\ast$ {\bfseries cen}}\label{restore_8c_a31ce65cf3eb59b34ee40e3f00408b216}

\item 
\hypertarget{restore_8c_a8033be02f23abd9bfd687b5ae609d04d}{\hyperlink{structBMEntry}{\-B\-M\-Entry} $\ast$ {\bfseries ben}}\label{restore_8c_a8033be02f23abd9bfd687b5ae609d04d}

\item 
\hyperlink{structDataInfo}{\-Data\-Info} \hyperlink{restore_8c_a4000ac7e3c4eabca67c3f3c519306300}{dinfo}
\item 
\hyperlink{structDataTable}{\-Data\-Table} $\ast$ \hyperlink{restore_8c_a3c7e91ebabcc98b968b08fc0e8cb17cd}{dt}
\item 
\hyperlink{structQueue}{\-Queue} $\ast$ \hyperlink{restore_8c_aae5860e76a87e8d38c5c4d4bf887258d}{dq}
\end{DoxyCompactItemize}


\subsection{\-Detailed \-Description}
\-Implements restoration of images without reverse deduplication. \-Implements restoration of images with reverse deduplication.

\begin{DoxyAuthor}{\-Author}
\-Ng \-Chun \-Ho 
\end{DoxyAuthor}


\subsection{\-Function \-Documentation}
\hypertarget{restore_8c_a6520fe309575d62e6a3311267c491bf5}{\index{restore.\-c@{restore.\-c}!decompress@{decompress}}
\index{decompress@{decompress}!restore.c@{restore.\-c}}
\subsubsection[{decompress}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ {\bf decompress} (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{ptr}
\end{DoxyParamCaption}
)}}\label{restore_8c_a6520fe309575d62e6a3311267c491bf5}
\-Decompression routine 
\begin{DoxyParams}{\-Parameters}
{\em ptr} & useless \\
\hline
\end{DoxyParams}
\-If it is locked, then other threads have decompressed this segment \hypertarget{restore_8c_a0ddf1224851353fc92bfbff6f499fa97}{\index{restore.\-c@{restore.\-c}!main@{main}}
\index{main@{main}!restore.c@{restore.\-c}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf main} (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}\label{restore_8c_a0ddf1224851353fc92bfbff6f499fa97}
\-Check whether the image is reversely deduplicated

\-Retrieving \-Metadata

\-Setup \hyperlink{structDataInfo}{\-Data\-Info}

\-Setup memory buffer for decompression

\-Setup \hyperlink{structDataTable}{\-Data\-Table} and prefetch

\-Setup decompress and send

wait for the outstanding threads \hypertarget{restore_8c_aaed3800a08e9d09b339503a082c9e9bc}{\index{restore.\-c@{restore.\-c}!prefetch@{prefetch}}
\index{prefetch@{prefetch}!restore.c@{restore.\-c}}
\subsubsection[{prefetch}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ {\bf prefetch} (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{ptr}
\end{DoxyParamCaption}
)}}\label{restore_8c_aaed3800a08e9d09b339503a082c9e9bc}
\hyperlink{structSegment}{\-Segment} prefetching routine 
\begin{DoxyParams}{\-Parameters}
{\em ptr} & \hyperlink{structQueue}{\-Queue} that holds either segment or bucket number \\
\hline
\end{DoxyParams}
\hypertarget{restore_8c_acc039373c16414237269e7bc088823f1}{\index{restore.\-c@{restore.\-c}!send@{send}}
\index{send@{send}!restore.c@{restore.\-c}}
\subsubsection[{send}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ {\bf send} (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{ptr}
\end{DoxyParamCaption}
)}}\label{restore_8c_acc039373c16414237269e7bc088823f1}
\-Routine for sending out data 
\begin{DoxyParams}{\-Parameters}
{\em ptr} & useless \\
\hline
\end{DoxyParams}
\-Ensure that the segment is fully decompressed 

\subsection{\-Variable \-Documentation}
\hypertarget{restore_8c_a4000ac7e3c4eabca67c3f3c519306300}{\index{restore.\-c@{restore.\-c}!dinfo@{dinfo}}
\index{dinfo@{dinfo}!restore.c@{restore.\-c}}
\subsubsection[{dinfo}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Data\-Info} {\bf dinfo}}}\label{restore_8c_a4000ac7e3c4eabca67c3f3c519306300}
\-Data \-Info for all threads \hypertarget{restore_8c_aae5860e76a87e8d38c5c4d4bf887258d}{\index{restore.\-c@{restore.\-c}!dq@{dq}}
\index{dq@{dq}!restore.c@{restore.\-c}}
\subsubsection[{dq}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Queue}$\ast$ {\bf dq}}}\label{restore_8c_aae5860e76a87e8d38c5c4d4bf887258d}
\hyperlink{structQueue}{\-Queue} for holding memory blocks for decompression \hypertarget{restore_8c_a3c7e91ebabcc98b968b08fc0e8cb17cd}{\index{restore.\-c@{restore.\-c}!dt@{dt}}
\index{dt@{dt}!restore.c@{restore.\-c}}
\subsubsection[{dt}]{\setlength{\rightskip}{0pt plus 5cm}{\bf \-Data\-Table}$\ast$ {\bf dt}}}\label{restore_8c_a3c7e91ebabcc98b968b08fc0e8cb17cd}
\-Data \-Table for holding decompressed data that will be later sending out 